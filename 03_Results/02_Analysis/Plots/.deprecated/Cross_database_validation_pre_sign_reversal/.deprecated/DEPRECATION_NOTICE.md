# Deprecation Notice

**Date**: 2025-11-27
**Reason**: Inconsistent pattern classifications using old magnitude-only algorithm

## Deprecated Files

### 1. `pathways_classified.csv`
- **Issue**: Contains pattern classifications using the OLD magnitude-only classifier
- **Problem**:
  - R403C shows **980 Progressive pathways** (magnitude-only criteria)
  - G32A shows **0 Progressive pathways**
  - Does not require statistical significance (p.adjust) for pattern assignment
  - Inconsistent with canonical significance-based classifier in `pattern_definitions.py`

### 2. `pattern_summary.csv`
- **Issue**: Aggregated counts derived from `pathways_classified.csv`
- **Problem**: Inherits the incorrect Progressive counts and other magnitude-only patterns

## Replacement Files

### Authoritative Master Tables (Use These Instead)

1. **`master_gsea_table.csv`** (109,990 rows)
   - Location: `03_Results/02_Analysis/master_gsea_table.csv`
   - Format: Long format (one row per pathway per contrast)
   - Pattern columns: `Pattern_G32A`, `Pattern_R403C`, `Confidence_G32A`, `Confidence_R403C`
   - Algorithm: Significance-based classifier from `pattern_definitions.py`
   - Result: **0 Progressive pathways** for both mutations (stringent criteria)
   - Generated by: `4.1.create_master_pathway_table.py`

2. **`gsea_results_wide.csv`** (12,222 rows)
   - Location: `03_Results/02_Analysis/Python_exports/gsea_results_wide.csv`
   - Format: Wide format (one row per pathway)
   - Contents: NES and p.adjust values for all contrasts
   - Use with: `add_pattern_classification()` from `pattern_definitions.py`
   - Generated by: `1.4.export_gsea_for_python.R`

## Migration Guide

### For Scripts Loading Pathway Data

**OLD CODE** (deprecated):
```python
data_file = '03_Results/02_Analysis/Plots/Cross_database_validation/pathways_classified.csv'
df = pd.read_csv(data_file)
```

**NEW CODE** (correct):
```python
from Python.data_loader import load_classified_pathways
df = load_classified_pathways()  # Loads from master_gsea_table.csv
```

### For Scripts Needing Pattern Classification

**Use the canonical classifier**:
```python
from Python.pattern_definitions import add_pattern_classification

# Load wide format data
df = pd.read_csv('03_Results/02_Analysis/Python_exports/gsea_results_wide.csv')

# Add significance-based pattern classifications
df = add_pattern_classification(df, mutations=['G32A', 'R403C'])
# Adds: Pattern_G32A, Confidence_G32A, Pattern_R403C, Confidence_R403C
```

## Impact on Figures

### Affected Visualizations (Now Fixed)
All figures using `load_classified_pathways()` now load from the authoritative master table:
- `3.1.publication_figures.py` - Main publication figures
- `3.2.publication_figures_dotplot.py` - Dotplot versions
- `3.4.pattern_summary_normalized.py` - Pattern distribution summaries

### Key Changes in Results
- **Progressive pathways**: 980 → 0 (R403C), magnitude-only → significance-based
- **Compensation pathways**: Remains dominant pattern (~1000 pathways per mutation)
- **Pattern proportions**: More accurate representation of statistically robust patterns

## Technical Details

### Old Magnitude-Only Classifier (Deprecated)
From `main` branch `01_Scripts/Python/patterns.py`:
- Progressive criteria:
  - `|Early NES| > 0.5` (no significance test)
  - `|Late NES| > |Early NES|` (magnitude worsening)
  - `|TrajDev NES| > 0.5` AND amplifies Early (no significance test)
- Result: 980 R403C Progressive pathways with potentially non-significant p-values

### New Significance-Based Classifier (Current)
From `01_Scripts/Python/pattern_definitions.py`:
- Progressive criteria:
  - Early: `p.adjust < 0.05` AND `|NES| > 0.5` ✅
  - TrajDev: `p.adjust < 0.05` AND `|NES| > 0.5` AND amplifies ✅
  - Late: `|Late|/|Early| > 1.3` (30% worsening)
- Result: 0 Progressive pathways (triple significance hurdle not met)

## See Also
- `docs/PATTERN_CLASSIFICATION.md` - Pattern classification framework documentation
- `docs/archive/2025-11-26_pattern_cleanup/report.md` - Detailed comparison of classifiers
- `01_Scripts/Python/pattern_definitions.py` - Canonical source of truth for patterns

## Questions?
See main repository documentation or contact the analysis lead.
