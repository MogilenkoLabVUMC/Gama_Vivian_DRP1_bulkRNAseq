# Differential Expression Results

**Location:** `03_Results/02_Analysis/DE_results/`
**Generated by:** `02_Analysis/1a.Main_pipeline.R` and `02_Analysis/1b.generate_contrast_tables.R`
**Last Updated:** 2025-11-25

---

## Overview

This folder contains differential expression statistics for all 9 contrasts analyzed in the DRP1 mutation study. Each file contains gene-level statistics from limma-voom analysis.

---

## File Inventory

### Current Files (`*_DE_results.csv`)

| File | Contrast | Biological Question |
|------|----------|---------------------|
| `G32A_vs_Ctrl_D35_DE_results.csv` | G32A vs Control at Day 35 | Early G32A mutation effect |
| `G32A_vs_Ctrl_D65_DE_results.csv` | G32A vs Control at Day 65 | Late G32A mutation effect |
| `R403C_vs_Ctrl_D35_DE_results.csv` | R403C vs Control at Day 35 | Early R403C mutation effect |
| `R403C_vs_Ctrl_D65_DE_results.csv` | R403C vs Control at Day 65 | Late R403C mutation effect |
| `Time_Ctrl_DE_results.csv` | D65 - D35 in Controls | Normal maturation |
| `Time_G32A_DE_results.csv` | D65 - D35 in G32A | G32A maturation |
| `Time_R403C_DE_results.csv` | D65 - D35 in R403C | R403C maturation |
| `Maturation_G32A_specific_DE_results.csv` | Interaction term | G32A-specific trajectory deviation |
| `Maturation_R403C_specific_DE_results.csv` | Interaction term | R403C-specific trajectory deviation |

### Legacy Files (`*_results.csv`)

The files without `_DE_` in the name are legacy versions from earlier pipeline runs. They contain identical data but are retained for backwards compatibility.

---

## Column Definitions

| Column | Description | Type | Range |
|--------|-------------|------|-------|
| *(row name)* | Gene symbol (HGNC) | character | ~21,000 genes |
| `logFC` | Log2 fold-change | numeric | typically -10 to +10 |
| `AveExpr` | Average log2 expression | numeric | -5 to +15 |
| `t` | Moderated t-statistic | numeric | typically -15 to +15 |
| `P.Value` | Raw p-value | numeric | 0 to 1 |
| `adj.P.Val` | FDR-adjusted p-value (BH) | numeric | 0 to 1 |
| `B` | B-statistic (log-odds of DE) | numeric | -10 to +20 |

---

## Statistical Methods

### Differential Expression Pipeline

```
1. TMM normalization (edgeR)
       ↓
2. voom log2-CPM transformation with precision weights
       ↓
3. Linear model fitting (voomLmFit)
       ↓
4. Contrast estimation (contrasts.fit)
       ↓
5. Empirical Bayes moderation (eBayes, robust=TRUE)
       ↓
6. Multiple testing correction (Benjamini-Hochberg)
```

### Key Parameters

| Parameter | Value | Script Location |
|-----------|-------|-----------------|
| p_cutoff | 0.05 | `config$p_cutoff` in 1a.Main_pipeline.R |
| fc_cutoff | 2 (|log2FC| > 1) | `config$fc_cutoff` in 1a.Main_pipeline.R |
| Robust eBayes | TRUE | `eBayes(robust = TRUE)` |
| Sort order | t-statistic | `sort_by = "t"` |

### Interpretation of Statistics

**logFC (log2 fold-change):**
- Positive: Higher expression in first condition (e.g., G32A > Ctrl)
- Negative: Lower expression in first condition (e.g., G32A < Ctrl)
- |logFC| > 1 corresponds to 2-fold change

**t-statistic:**
- Used as ranking metric for GSEA
- Combines effect size (logFC) and precision
- Positive: upregulated; Negative: downregulated

**adj.P.Val (FDR):**
- < 0.05: Statistically significant after correction
- < 0.01: Highly significant
- Recommended threshold for DE gene lists

**B-statistic:**
- Log-odds that the gene is differentially expressed
- B > 0: More likely DE than not
- Higher B = stronger evidence

---

## Contrast Interpretation

### Mutation Effects (Baseline Comparisons)

```
G32A_vs_Ctrl_D35:  D35_G32A - D35_Control
                   "What genes differ between G32A and Control at Day 35?"

R403C_vs_Ctrl_D35: D35_R403C - D35_Control
                   "What genes differ between R403C and Control at Day 35?"

G32A_vs_Ctrl_D65:  D65_G32A - D65_Control
                   "What genes differ between G32A and Control at Day 65?"

R403C_vs_Ctrl_D65: D65_R403C - D65_Control
                   "What genes differ between R403C and Control at Day 65?"
```

### Maturation Effects (Time Comparisons)

```
Time_Ctrl:  D65_Control - D35_Control
            "How do Control neurons change during maturation?"

Time_G32A:  D65_G32A - D35_G32A
            "How do G32A neurons change during maturation?"

Time_R403C: D65_R403C - D35_R403C
            "How do R403C neurons change during maturation?"
```

### Interaction Effects (Difference-in-Difference)

```
Maturation_G32A_specific:
    (D65_G32A - D35_G32A) - (D65_Control - D35_Control)
    "Does G32A alter the normal maturation trajectory?"

Maturation_R403C_specific:
    (D65_R403C - D35_R403C) - (D65_Control - D35_Control)
    "Does R403C alter the normal maturation trajectory?"
```

---

## Usage Examples

### R: Load and filter significant genes

```r
library(dplyr)

# Load results
de <- read.csv("G32A_vs_Ctrl_D35_DE_results.csv", row.names = 1)

# Significant genes (FDR < 0.05)
sig_genes <- de %>%
  filter(adj.P.Val < 0.05) %>%
  arrange(adj.P.Val)

# Significant with fold-change threshold
sig_fc <- de %>%
  filter(adj.P.Val < 0.05, abs(logFC) > 1) %>%
  arrange(desc(abs(logFC)))

# Upregulated genes
up_genes <- de %>%
  filter(adj.P.Val < 0.05, logFC > 1)

# Downregulated genes
down_genes <- de %>%
  filter(adj.P.Val < 0.05, logFC < -1)
```

### R: Create ranked gene list for GSEA

```r
# Rank by t-statistic (recommended for GSEA)
ranked_genes <- de$t
names(ranked_genes) <- rownames(de)
ranked_genes <- sort(ranked_genes, decreasing = TRUE)
```

### Python: Load and analyze

```python
import pandas as pd

# Load results
de = pd.read_csv("G32A_vs_Ctrl_D35_DE_results.csv", index_col=0)

# Significant genes
sig = de[de['adj.P.Val'] < 0.05]

# Volcano plot data
de['significant'] = de['adj.P.Val'] < 0.05
de['-log10_pval'] = -np.log10(de['P.Value'])
```

---

## Relationship to Other Results

### Downstream Analysis

```
DE_results/*.csv
      │
      ├──→ Volcano plots (Plots/Volcano/)
      │    Uses: logFC, P.Value, adj.P.Val
      │
      ├──→ GSEA ranking (Plots/GSEA/)
      │    Uses: t-statistic for ranking
      │
      ├──→ Calcium gene analysis (Calcium_genes/)
      │    Uses: Full table filtered by gene list
      │
      └──→ Python exports (Python_exports/)
           Uses: Merged with GSEA results
```

### Source Checkpoints

These tables are derived from:
- `checkpoints/contrast_tables.rds` - All contrasts in single R object
- `checkpoints/model_objects.rds` - Full limma model fit

---

## Quality Control

### Expected Gene Counts

Typical DE gene counts per contrast (FDR < 0.05):

| Contrast Type | Expected Range |
|---------------|----------------|
| Mutation vs Ctrl | 500 - 3,000 genes |
| Time effects | 2,000 - 8,000 genes |
| Interaction | 100 - 1,000 genes |

### Validation Checks

```r
# Check data integrity
nrow(de)  # Should be ~21,000 genes
sum(is.na(de$logFC))  # Should be 0
range(de$adj.P.Val)  # Should be 0-1
```

---

## File Generation

### From Main Pipeline

```r
# In 02_Analysis/1a.Main_pipeline.R
contrast_tables <- process_all_contrasts(fit, contrasts, number = Inf, sort_by = "t")
save_contrast_csvs(contrast_tables, deg_dir, suffix = "_DE_results.csv")
```

### Standalone Regeneration

```bash
Rscript 02_Analysis/1b.generate_contrast_tables.R
```

This script loads cached checkpoints and regenerates CSV files without re-running the full pipeline.

---

## Version History

| Date | Change | Files |
|------|--------|-------|
| 2025-11-24 | Re-generated with updated pipeline | All *_DE_results.csv |
| 2025-11-19 | Initial generation (legacy) | All *_results.csv |

---

## Related Documentation

- `../README.md` - Main analysis overview
- `../checkpoints/README.md` - Source checkpoint files
- `../Plots/Volcano/README.md` - Volcano plot visualization
- `CLAUDE.md` - Pipeline configuration details
