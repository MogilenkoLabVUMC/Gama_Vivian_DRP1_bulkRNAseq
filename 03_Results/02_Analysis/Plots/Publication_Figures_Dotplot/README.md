# Publication_Figures_Dotplot

## Overview

This folder contains dotplot versions of the main publication figures. Dotplots encode statistical significance through dot size, making it easier to identify significant pathways compared to the heatmap versions in the parent `Publication_Figures/` directory.

## Generating Script

- `02_Analysis/3.2.publication_figures_dotplot.py` - Generates all dotplot publication figures

**Runtime:** ~30 seconds

**Dependencies:**
- Master GSEA table: `03_Results/02_Analysis/master_gsea_table.csv` (generated by `1.5.create_master_pathway_table.py`)
- Semantic categories: `01_Scripts/Python/semantic_categories.py`
- Pattern definitions: `01_Scripts/Python/pattern_definitions.py`
- DotplotRenderer class: `01_Scripts/RNAseq-toolkit/scripts/GSEA/GSEA_plotting_python/dotplot_renderer.py`

## Contents

### Figures

| File | Description | Generated By |
|------|-------------|-------------|
| `Fig1_Ribosome_Paradox_dotplot.pdf` | 3-panel dotplot showing ribosome paradox (biogenesis up, synaptic down, mito translation up) across trajectory stages | `3.2.publication_figures_dotplot.py` |
| `Fig1_Ribosome_Paradox_dotplot.png` | PNG version (300 DPI) of ribosome paradox dotplot | `3.2.publication_figures_dotplot.py` |
| `Fig2_MitoCarta_Trajectory_Patterns_dotplot.pdf` | Dotplot of all MitoCarta pathways showing trajectory patterns (Early, TrajDev, Late) for G32A and R403C mutations | `3.2.publication_figures_dotplot.py` |
| `Fig2_MitoCarta_Trajectory_Patterns_dotplot.png` | PNG version of MitoCarta trajectory patterns dotplot | `3.2.publication_figures_dotplot.py` |
| `Fig3b_SynGO_Trajectory_Patterns_dotplot.pdf` | Dotplot of all SynGO pathways showing trajectory patterns across mutations | `3.2.publication_figures_dotplot.py` |
| `Fig3b_SynGO_Trajectory_Patterns_dotplot.png` | PNG version of SynGO trajectory patterns dotplot | `3.2.publication_figures_dotplot.py` |
| `Fig3_Pattern_Classification_Summary.pdf` | Bar chart showing distribution of pattern classifications (Compensation, Sign_reversal, Progressive, etc.) - identical to original | `3.2.publication_figures_dotplot.py` |
| `Fig3_Pattern_Classification_Summary.png` | PNG version of pattern classification bar chart | `3.2.publication_figures_dotplot.py` |
| `Fig4_Semantic_Pathway_Overview_dotplot.pdf` | Comprehensive dotplot of semantic pathway categories across all databases and contrasts | `3.2.publication_figures_dotplot.py` |
| `Fig4_Semantic_Pathway_Overview_dotplot.png` | PNG version of semantic pathway overview dotplot | `3.2.publication_figures_dotplot.py` |

## Dotplot Visual Encoding

Each dot in the dotplots encodes three pieces of information:

1. **Dot Color**: NES (Normalized Enrichment Score)
   - Blue = downregulated pathways (negative NES)
   - Orange = upregulated pathways (positive NES)
   - White = no enrichment (NES ≈ 0)
   - Uses colorblind-safe Blue-White-Orange diverging palette

2. **Dot Size**: Statistical significance (-log10(padj))
   - Larger dots = more significant (lower padj values)
   - Smaller dots = less significant (higher padj values)
   - Size range: 20-300 points
   - Calculation: `min_size + (neg_log_padj/10) * (max_size - min_size)`
   - Visual size legend included in all figures

3. **Dot Edge**: Significance threshold indicator
   - Black outline (linewidth=2) = padj < 0.05 (significant)
   - Gray outline (linewidth=1) = padj ≥ 0.05 (not significant)

## Size Legend Design

All figures include a visual size legend showing:
- Example dots at padj = 0.001, 0.01, 0.05, and 0.1
- Labels explaining significance levels (highly sig, very sig, threshold, not sig)
- Clear indication of which dots have black edges (significant) vs gray edges (not significant)

**Example sizes** (for min_dot_size=20, max_dot_size=300):
- padj = 0.001 → -log10(p) = 3.0 → size = 104 (highly significant)
- padj = 0.01  → -log10(p) = 2.0 → size = 76 (very significant)
- padj = 0.05  → -log10(p) = 1.3 → size = 56 (threshold)
- padj = 0.1   → -log10(p) = 1.0 → size = 48 (not significant)

**Technical improvements (2025-11-25):**
- Legend dots use **actual** calculated sizes from `DotplotRenderer._calculate_dot_sizes()` (no artificial scaling)
- Horizontal spacing increased to prevent text overlap (`np.linspace(0.15, 0.85, 4)`)
- Two-line label format with better vertical positioning
- Increased legend area height across all figures for clarity

## Trajectory Framework

All figures follow the trajectory framework:
- **Early**: D35 mutation effects (G32A_vs_Ctrl_D35, R403C_vs_Ctrl_D35)
- **TrajDev**: Mutation-specific developmental trajectory changes (Maturation_G32A_specific, Maturation_R403C_specific)
- **Late**: D65 mutation effects (G32A_vs_Ctrl_D65, R403C_vs_Ctrl_D65)

## How to Regenerate

```bash
python3 02_Analysis/3.2.publication_figures_dotplot.py
```

This will regenerate all dotplot figures without affecting the original heatmap versions.

## Advantages Over Heatmap Version

- **More intuitive**: Dot size immediately conveys significance level
- **Better visual clarity**: Dots don't bleed together like heatmap cells
- **Easier pattern recognition**: Large black-outlined dots (highly significant) stand out clearly
- **Publication-standard**: Dotplots are the standard visualization for pathway enrichment analysis
- **Emphasis on significance**: Size encoding makes it easier to identify statistically robust findings

## Data Filtering

- CGP database excluded (cancer-focused, not relevant to neuronal analysis)
- Pathways must have ≥3 trajectory data points
- At least one significant result (padj < 0.05) required for pathway inclusion
- Same semantic categories and filtering criteria as heatmap version

## Technical Implementation

**DotplotRenderer class**
- Location: `01_Scripts/RNAseq-toolkit/scripts/GSEA/GSEA_plotting_python/dotplot_renderer.py`
- Handles consistent dot size calculation across all figures
- Manages edge color assignment based on significance threshold (padj < 0.05)
- Ensures dot sizes in legend match actual figure dots exactly

**Size calculation formula:**
```python
neg_log_padj = -np.log10(padj_matrix)
neg_log_padj_clipped = np.clip(neg_log_padj, 0, 10)
normalized = neg_log_padj_clipped / 10
dot_sizes = min_dot_size + normalized * (max_dot_size - min_dot_size)
```

## Comparison with Original Heatmaps

### When to Use Heatmaps (Publication_Figures/)
- Color intensity encodes NES continuously
- Better for visualizing gradients across many pathways
- Emphasizes pattern continuity
- When you want to emphasize the magnitude of enrichment scores

### When to Use Dotplots (This Folder)
- Dot size encodes significance explicitly
- Better for identifying statistically significant pathways
- Easier to interpret in presentations
- Standard format for pathway enrichment publications
- When statistical significance is a key message

**Both versions use identical:**
- Data sources and filtering criteria
- Trajectory framework structure
- Pattern classifications
- Colorblind-safe color palette (Blue-White-Orange)

## Related Visualizations

- **Publication_Figures/** - Original heatmap versions (main manuscript figures)
- **Ribosome_paradox/** - Core ribosome downregulation finding
- **Mito_translation_cascade/** - Mitochondrial translation cascade mechanistic visualization
- **Synaptic_ribosomes/** - Synaptic translation deep-dive analysis
- **Critical_period_trajectories/** - GSVA-based temporal trajectory analysis
- **Cross_database_validation/** - Cross-database pattern validation

## Notes

- All figures maintain aspect ratios optimized for publication
- PDF versions are vector graphics suitable for journal submission
- PNG versions (300 DPI) are suitable for presentations
- Size legend included in all dotplot figures for interpretability
- Pattern classification (Fig3) is identical between heatmap and dotplot versions (it's a bar chart, not a heatmap/dotplot)
- All filtering criteria, semantic categories, and pattern definitions are consistent with the original heatmap version

## Verification

To verify dot sizes match between legend and figures:
1. Open any dotplot PDF
2. Compare dots in the legend with dots in the main figure
3. For a given padj value, sizes should be identical (no scaling)
