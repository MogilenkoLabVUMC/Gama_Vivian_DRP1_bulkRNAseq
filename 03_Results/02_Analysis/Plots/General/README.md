# General Quality Control Plots

**Location:** `03_Results/02_Analysis/Plots/General/`
**Generated by:** `02_Analysis/1a.Main_pipeline.R`
**Last Updated:** 2025-11-25

---

## Overview

This directory contains quality control (QC) visualizations that assess sample quality, replicate consistency, and overall data structure before differential expression analysis.

---

## File Inventory

| File | Size | Description |
|------|------|-------------|
| `sample_correlation_heatmap_ordered.pdf` | 10 KB | Sample-sample correlation matrix |
| `MDS_plot.pdf` | 6 KB | Multi-dimensional scaling plot |
| `DE_gene_counts.pdf` | 4 KB | DEG counts by contrast |
| `UpSet_plot_all_contrasts.pdf` | 8 KB | Overlap of significant genes |

---

## Plot Descriptions

### Sample Correlation Heatmap

**File:** `sample_correlation_heatmap_ordered.pdf`

**What it shows:**
- Pearson correlation of log-CPM expression between all sample pairs
- Samples ordered by timepoint (D35 → D65) then genotype (Control → G32A → R403C)
- Annotation bars showing genotype and timepoint

**Color scheme:**
- Yellow/Brown scale: Higher = more similar (r closer to 1)
- Annotation: Genotype (green=Control, orange=G32A, purple=R403C)
- Annotation: Days (pink=D35, green=D65)

**Expected patterns:**
- High correlation within replicates (r > 0.95)
- Higher correlation within genotype than between
- Visible timepoint clustering

**Quality checks:**
- ✓ No outlier samples (low correlation with group)
- ✓ Replicates cluster together
- ✓ Expected biological groupings visible

### MDS Plot

**File:** `MDS_plot.pdf`

**What it shows:**
- Multi-dimensional scaling (like PCA) of sample distances
- Each point = one sample
- Colors = genotype
- Shapes = timepoint (circle=D35, triangle=D65)

**Interpretation:**
- X-axis (Leading logFC dim 1): Primary source of variation
- Y-axis (Leading logFC dim 2): Secondary source of variation
- Samples that cluster = similar expression profiles

**Expected patterns:**
- Samples group by genotype and/or timepoint
- Replicates cluster tightly
- Mutations separate from controls

### DE Gene Counts

**File:** `DE_gene_counts.pdf`

**What it shows:**
- Bar chart of differentially expressed gene counts
- Each contrast on x-axis
- Bars split by direction (Up/Down)
- Count labels on each bar

**Color coding:**
- Orange: Upregulated genes
- Blue: Downregulated genes

**Typical counts:**
| Contrast Type | Expected DEGs |
|---------------|---------------|
| Mutation vs Ctrl | 500 - 3,000 |
| Time effects | 2,000 - 8,000 |
| Interaction | 100 - 1,000 |

### UpSet Plot

**File:** `UpSet_plot_all_contrasts.pdf`

**What it shows:**
- Intersection sizes between contrast gene lists
- More interpretable alternative to Venn diagram
- Horizontal bars: Total genes per contrast
- Vertical bars: Intersection sizes
- Connected dots: Which contrasts share genes

**Interpretation:**
- Largest vertical bars = most shared gene signatures
- Isolated dots = contrast-specific genes
- Connected patterns = which contrasts co-regulate genes

---

## Generation Code

```r
# Sample correlation heatmap
pdf(file.path(qc_dir, "sample_correlation_heatmap_ordered.pdf"), 12, 10)
pheatmap(ordered_cor,
         annotation_row  = annot,
         annotation_col = annot,
         annotation_colors = ann_colors,
         color = colorRampPalette(brewer.pal(9,"YlOrBr"))(100),
         cluster_rows = FALSE,
         cluster_cols = FALSE,
         border_color = NA)
dev.off()

# MDS plot
pdf(file.path(qc_dir,"MDS_plot.pdf"), 10, 8)
plotMDS(v, col = ann_colors$genotype[annot$genotype],
        pch = ifelse(annot$days=="D35", 16, 17),
        cex = 1.4)
legend("topright", legend = leg_lbl,
       col = leg_col, pch = leg_pch)
dev.off()

# DE gene counts
pdf(file.path(qc_dir,"DE_gene_counts.pdf"), 10, 6)
ggplot(deg_long, aes(Contrast, Count, fill = Direction)) +
  geom_col(position = position_dodge(width = .8), width = .7) +
  geom_text(aes(label = Count), vjust = -.2,
            position = position_dodge(width = .8), size = 3) +
  scale_fill_manual(values = c(Up = "#D55E00", Down = "#0072B2"))
dev.off()

# UpSet plot
pdf(file.path(qc_dir, "UpSet_plot_all_contrasts.pdf"), width = 12, height = 8)
upset(fromList(sig_genes_list), order.by = "freq", nsets = length(sig_genes_list))
dev.off()
```

---

## Quality Control Checklist

### Sample Quality

- [ ] All samples have high correlation with replicates (r > 0.9)
- [ ] No sample is an outlier in MDS plot
- [ ] Expected batch/group structure visible

### Differential Expression

- [ ] Reasonable DEG counts (not 0, not all genes)
- [ ] Up and down genes balanced (unless biology dictates otherwise)
- [ ] Time effects show more DEGs than interactions

### Biological Consistency

- [ ] Mutations cluster separately from controls
- [ ] Timepoints show expected separation
- [ ] Replicate variation smaller than biological variation

---

## Sample Information

### Sample Order (as used in heatmap)

```
D35_Control_1, D35_Control_2, D35_Control_3,
D35_G32A_1, D35_G32A_2, D35_G32A_3,
D35_R403C_1, D35_R403C_2, D35_R403C_3,
D65_Control_1, D65_Control_2, D65_Control_3,
D65_G32A_1, D65_G32A_2, D65_G32A_3,
D65_R403C_1, D65_R403C_2, D65_R403C_3
```

### Color Palette

```r
ann_colors <- list(
  genotype = c(Control = "#1B9E77", G32A = "#D95F02", R403C = "#7570B3"),
  days     = c(D35 = "#E7298A", D65 = "#66A61E")
)
```

---

## Related Documentation

- `../README.md` - Overall Plots directory
- `../../README.md` - Main analysis overview
- `../../checkpoints/README.md` - Source QC data (qc_variables.rds)
