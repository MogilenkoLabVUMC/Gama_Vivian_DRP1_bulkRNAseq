# Volcano Plot Visualizations

**Location:** `03_Results/02_Analysis/Plots/Volcano/`
**Generated by:** `02_Analysis/1a.Main_pipeline.R`
**Last Updated:** 2025-11-25

---

## Overview

This directory contains volcano plots for all 9 experimental contrasts, generated in multiple styles and with different significance thresholds. Volcano plots display gene-level differential expression as log2 fold-change (x-axis) vs statistical significance (y-axis).

---

## Directory Structure

```
Volcano/
├── README.md (this file)
│
├── p/                          # Standard horizontal, p-value threshold
│   └── [contrast]_standard.pdf
│
├── fdr/                        # Standard horizontal, FDR threshold
│   └── [contrast]_standard.pdf
│
├── vertical_p/                 # Vertical format, p-value threshold
│   └── [contrast]_vertical.pdf
│
├── vertical_fdr/               # Vertical format, FDR threshold
│   └── [contrast]_vertical.pdf
│
├── vertical_p_calcium/         # Vertical with calcium genes, p-value
│   └── [contrast]_vertical.pdf
│
├── vertical_fdr_calcium/       # Vertical with calcium genes, FDR
│   └── [contrast]_vertical.pdf
│
├── MD/                         # Mean-Difference plots
│   └── [contrast]_MDplot.pdf
│
└── FC-B/                       # Fold-Change vs B-statistic plots
    └── [contrast]_FC_vs_B.pdf
```

---

## Plot Types

### Standard Volcano Plots

**Folders:** `p/`, `fdr/`

**Axes:**
- X-axis: log2 Fold-Change
- Y-axis: -log10(p-value)

**Features:**
- Points colored by significance status
- Horizontal dashed line: significance threshold
- Vertical dashed lines: fold-change threshold (|log2FC| = 1)
- Top genes labeled

**p/ vs fdr/:**
- `p/`: Uses raw p-value < 0.05 for coloring
- `fdr/`: Uses FDR-adjusted p-value < 0.10 for coloring
- Both display raw p-value on y-axis for resolution

### Vertical Volcano Plots

**Folders:** `vertical_p/`, `vertical_fdr/`

**Same as standard but:**
- Rotated 90 degrees (log2FC on y-axis)
- Better for comparing across contrasts
- More readable gene labels

### Calcium-Highlighted Volcanoes

**Folders:** `vertical_p_calcium/`, `vertical_fdr_calcium/`

**Same as vertical but:**
- Calcium signaling genes highlighted in red
- Calcium genes always labeled (regardless of significance)
- Useful for focused hypothesis testing

**Calcium genes highlighted:**
```
NNAT, CACNG3, CACNA1S, ATP2A1, RYR1, MYLK3, VDR,
STIM1, STIM2, ORAI1_1, CALB1, CALR, PNPO
```

### Mean-Difference (MD) Plots

**Folder:** `MD/`

**Axes:**
- X-axis: Average log2 expression (AveExpr)
- Y-axis: log2 Fold-Change

**Purpose:**
- Shows expression level context
- Identifies genes with low expression
- Reveals mean-variance relationship

### Fold-Change vs B-statistic Plots

**Folder:** `FC-B/`

**Axes:**
- X-axis: log2 Fold-Change
- Y-axis: B-statistic (log-odds of DE)

**Purpose:**
- B-statistic combines significance and effect size
- B > 0 means gene is more likely DE than not
- Useful for identifying high-confidence hits

---

## Contrasts Covered

Each folder contains plots for all 9 contrasts:

| File Pattern | Contrast |
|--------------|----------|
| `G32A_vs_Ctrl_D35_*` | G32A vs Control at Day 35 |
| `G32A_vs_Ctrl_D65_*` | G32A vs Control at Day 65 |
| `R403C_vs_Ctrl_D35_*` | R403C vs Control at Day 35 |
| `R403C_vs_Ctrl_D65_*` | R403C vs Control at Day 65 |
| `Time_Ctrl_*` | Control maturation (D65 - D35) |
| `Time_G32A_*` | G32A maturation |
| `Time_R403C_*` | R403C maturation |
| `Maturation_G32A_specific_*` | G32A interaction effect |
| `Maturation_R403C_specific_*` | R403C interaction effect |

---

## Threshold Parameters

### p-value Mode

| Parameter | Value |
|-----------|-------|
| Significance cutoff | p < 0.05 |
| Fold-change cutoff | |log2FC| > 1 |
| Labeling | Top genes by significance |

### FDR Mode

| Parameter | Value |
|-----------|-------|
| Significance cutoff | FDR < 0.10 |
| Fold-change cutoff | |log2FC| > 1 |
| Labeling | Top genes by significance |

---

## Interpretation Guide

### Reading a Volcano Plot

```
                    ▲ -log10(p-value)
                    │
    Significantly   │   Significantly
    DOWN            │   UP
    (log2FC < -1,   │   (log2FC > 1,
     p < 0.05)      │    p < 0.05)
                    │
    ─────────────── ┼ ─────────────── threshold
                    │
    Not significant │ Not significant
    (small effect   │  (small effect
     or high p)     │   or high p)
                    │
    ────────────────┼────────────────► log2FC
                    0
```

### Color Coding

| Color | Meaning |
|-------|---------|
| Red | Significant upregulation (log2FC > 1, p < threshold) |
| Blue | Significant downregulation (log2FC < -1, p < threshold) |
| Gray | Not significant (p ≥ threshold or |log2FC| ≤ 1) |
| Orange/Yellow | Significant but |log2FC| ≤ 1 (optional) |

### Gene Labels

- Top 5-10 most significant genes labeled
- Calcium genes always labeled in `*_calcium` versions
- Labels positioned to minimize overlap

---

## Key Findings

### Most Significant Genes Across Contrasts

| Contrast | Top Upregulated | Top Downregulated |
|----------|-----------------|-------------------|
| G32A_vs_Ctrl_D35 | Cell cycle genes | NNAT, synaptic |
| G32A_vs_Ctrl_D65 | Ribosome biogenesis | Translation |
| Maturation_G32A_specific | DNA repair | Synaptic ribosomes |

### NNAT (Neuronatin)

Consistently appears as highly significant:
- Strong downregulation in mutations
- log2FC ~ -4 (16-fold decrease)
- Visible in all mutation vs control contrasts

---

## Usage Examples

### Compare mutations at Day 35

```bash
# Open both mutation contrasts side by side
open "vertical_fdr/G32A_vs_Ctrl_D35_vertical.pdf"
open "vertical_fdr/R403C_vs_Ctrl_D35_vertical.pdf"
```

### Focus on calcium genes

```bash
# View calcium-highlighted version
open "vertical_fdr_calcium/G32A_vs_Ctrl_D35_vertical.pdf"
```

### Check expression-dependent effects

```bash
# View MD plot to see expression levels
open "MD/G32A_vs_Ctrl_D35_MDplot.pdf"
```

---

## Generation Script

All volcano plots are generated by `02_Analysis/1a.Main_pipeline.R`:

### Standard Volcanoes

```r
generate_volcano_set <- function(mode = c("p", "fdr")) {
  for (contrast in names(contrast_tables)) {
    plot <- create_standard_volcano(
      contrast_tables[[contrast]],
      p_cutoff = params$p_cutoff,
      fc_cutoff = config$fc_cutoff,
      decision_by = mode,
      highlight_gene = config$calcium_genes
    )
    save_plot(plot, file.path(volcano_dir, paste0(contrast, "_standard.pdf")))
  }
}
```

### Vertical Volcanoes

```r
generate_vertical_volcano_sets(contrast_tables, config, highlight_calcium = TRUE)
```

### MD Plots

```r
for (contrast in names(contrast_tables)) {
  plot <- create_MD_plot(
    fit = fit,
    coef = contrast,
    de_results = contrast_tables[[contrast]],
    fc_cutoff = 1,
    fdr_cutoff = 0.05,
    highlight_gene = config$calcium_genes
  )
  save_plot(plot, file.path(md_dir, paste0(contrast, "_MDplot.pdf")))
}
```

### FC-B Plots

```r
for (contrast in names(contrast_tables)) {
  plot <- create_B_FC_plot(
    contrast_tables[[contrast]],
    fc_cutoff = config$fc_cutoff,
    B_cutoff = 0,
    highlight_gene = config$calcium_genes
  )
  save_plot(plot, file.path(fc_b_dir, paste0(contrast, "_FC_vs_B.pdf")))
}
```

---

## Helper Functions

Volcano plotting functions are sourced from:

```r
source_if_present(config$helper_root, "scripts/DE/plot_standard_volcano.R")
source_if_present(config$helper_root, "scripts/DE/create_fc_b_plot.R")
source_if_present(config$helper_root, "scripts/DE/create_MD_plot.R")
source_if_present("01_Scripts/R_scripts/generate_vertical_volcanos.R")
```

Located in `01_Scripts/RNAseq-toolkit/` (git submodule).

---

## Related Documentation

- `../README.md` - Overall Plots directory
- `../../DE_results/README.md` - Source DE statistics
- `../../Calcium_genes/README.md` - Calcium-focused analysis
- `01_Scripts/RNAseq-toolkit/scripts/DE/` - Plotting functions
