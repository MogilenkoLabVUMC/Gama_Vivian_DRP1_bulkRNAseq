# Pattern_Summary_Normalized

## Overview

This folder contains normalized pattern distribution visualizations that address database size bias in pattern analysis. Large databases (e.g., gobp with ~5000 pathways) can mask pattern distributions in smaller databases when using absolute counts. These normalized views enable fair comparison of relative pattern proportions across databases of different sizes.

## Generating Script

- **`02_Analysis/3.4.pattern_summary_normalized.py`** - Generates all normalized pattern summary visualizations

## Contents

### Normalized Summary Figures

| File | Description | Generated By |
|------|-------------|--------------|
| `pattern_summary_normalized.pdf` | Main normalized pattern summary with 100% stacked bars for both mutations (G32A and R403C) showing relative pattern proportions per database with absolute count annotations | `3.4.pattern_summary_normalized.py` |
| `pattern_summary_normalized.png` | PNG version of normalized pattern summary (150 DPI) | `3.4.pattern_summary_normalized.py` |

### Dual-Panel Comparison Figures

| File | Description | Generated By |
|------|-------------|--------------|
| `pattern_comparison_dual_G32A.pdf` | Dual-panel comparison for G32A mutation: normalized proportions (left) vs absolute counts (right) | `3.4.pattern_summary_normalized.py` |
| `pattern_comparison_dual_G32A.png` | PNG version of G32A dual-panel comparison (150 DPI) | `3.4.pattern_summary_normalized.py` |
| `pattern_comparison_dual_R403C.pdf` | Dual-panel comparison for R403C mutation: normalized proportions (left) vs absolute counts (right) | `3.4.pattern_summary_normalized.py` |
| `pattern_comparison_dual_R403C.png` | PNG version of R403C dual-panel comparison (150 DPI) | `3.4.pattern_summary_normalized.py` |

### Heatmap Figures

| File | Description | Generated By |
|------|-------------|--------------|
| `pattern_summary_heatmap.pdf` | Heatmap showing percentage of each pattern per database for both mutations with absolute counts annotated in cells | `3.4.pattern_summary_normalized.py` |
| `pattern_summary_heatmap.png` | PNG version of pattern summary heatmap (150 DPI) | `3.4.pattern_summary_normalized.py` |

## Technical Details

**Visualization Approaches:**

1. **Normalized 100% Stacked Bars** (`pattern_summary_normalized.*`)
   - Each database bar normalized to 100% for proportion comparison
   - Absolute counts shown as text annotations: "N (%)"
   - Total pathways per database shown as "n=X" at right
   - Enables comparison across databases of vastly different sizes

2. **Dual-Panel Comparison** (`pattern_comparison_dual_*.*`)
   - Panel A: Normalized pattern distribution (proportions)
   - Panel B: Absolute pathway counts (reference)
   - Side-by-side view for both perspectives
   - Separate figures for G32A and R403C mutations

3. **Percentage Heatmap** (`pattern_summary_heatmap.*`)
   - Compact view showing all data in matrix format
   - Color intensity represents percentage (0-100%)
   - Cell text shows: "X% (n=Y)"
   - Both mutations displayed side-by-side

**Data Source:**
- Reads pre-classified pathway data from `03_Results/02_Analysis/master_gsea_table.csv`
- Uses significance-based pattern classifications
- Filters to meaningful patterns (excludes Complex for cleaner visualization)

**Pattern Categories Shown:**
- Compensation
- Sign_reversal
- Progressive
- Natural_worsening
- Natural_improvement
- Late_onset
- Transient
- (Complex excluded from visualizations)

**Color Scheme:**
- Pattern colors: Defined in `01_Scripts/Python/semantic_categories.py`
- Mutation colors: G32A (teal), R403C (purple)

## How to Regenerate

```bash
# From repository root
python3 02_Analysis/3.4.pattern_summary_normalized.py
```

**Prerequisites:**
- `03_Results/02_Analysis/master_gsea_table.csv` must exist (generated by `4.1.create_master_pathway_table.py`)
- Python environment with matplotlib, pandas, numpy

**Runtime:** < 1 minute

## Usage Notes

**When to use these figures:**
- Comparing pattern proportions across databases of different sizes
- Understanding relative prevalence of different trajectory patterns
- Publication figures requiring fair database comparisons

**Comparison with original pattern summary:**
- **Original** (`Plots/Pattern_Summary/`): Absolute counts (database size dominates visual)
- **Normalized** (this folder): Proportions (equal comparison across databases)

**Recommendation:** Use normalized version for pattern comparison, reference original for absolute context.

## File Format Details

**PDF files:**
- Vector format (scalable)
- 300 DPI resolution
- Suitable for publication

**PNG files:**
- Raster format
- 150 DPI resolution
- Suitable for presentations and web display

**Figure dimensions:**
- Normalized summary: 16" × 8" (dual-mutation side-by-side)
- Dual-panel comparison: 16" × 8" (normalized vs absolute)
- Heatmap: 14" × 8" (compact matrix view)
