# Python Data Exports

**Location:** `03_Results/02_Analysis/Python_exports/`
**Generated by:** `02_Analysis/3.export_gsea_for_python.R`
**Last Updated:** 2025-11-25

---

## Overview

This folder contains CSV exports of GSEA results formatted for Python-based visualization and analysis. These files bridge the R analysis pipeline with Python visualization scripts.

---

## File Inventory

| File | Size | Rows | Description |
|------|------|------|-------------|
| `gsea_results_long.csv` | 31 MB | ~110K | All GSEA statistics in long format |
| `gsea_results_wide.csv` | 4.9 MB | ~12K | Pivot table (NES values wide) |
| `gsea_significant.csv` | 14 MB | ~47K | Significant pathways only (FDR < 0.05) |
| `gsea_trajectory_all.csv` | 22 MB | ~73K | Trajectory contrasts only (Early/Late/TrajDev) |
| `gsea_trajectory.csv` | 7.3 MB | ~24K | Significant trajectory pathways |
| `contrast_mapping.csv` | 490 B | 9 | Contrast name translations |

---

## File Details

### gsea_results_long.csv

**Purpose:** Complete GSEA results in analysis-ready format

**Columns:**

| Column | Type | Description |
|--------|------|-------------|
| `pathway_id` | string | Unique ID (format: `database::pathway_name`) |
| `database` | string | Source database (hallmark, kegg, etc.) |
| `ID` | string | Original pathway ID |
| `Description` | string | Human-readable pathway name |
| `contrast` | string | Original contrast name |
| `new_name` | string | Trajectory framework name |
| `category` | string | Stage: Early, Late, TrajDev, Reference |
| `mutation` | string | G32A, R403C, or Control |
| `NES` | float | Normalized Enrichment Score |
| `pvalue` | float | Raw p-value |
| `p.adjust` | float | FDR-adjusted p-value |
| `qvalue` | float | Q-value |
| `enrichmentScore` | float | Raw enrichment score |
| `setSize` | int | Number of genes in set |

### gsea_results_wide.csv

**Purpose:** Pivot table for cross-contrast comparisons

**Structure:**
- Rows: pathways
- Columns: NES values for each contrast

```
pathway_id, database, Description, NES_Early_G32A, NES_Late_G32A, NES_TrajDev_G32A, ...
```

### gsea_significant.csv

**Purpose:** Pre-filtered significant results for visualization

**Filter:** `p.adjust < 0.05`

### gsea_trajectory_all.csv

**Purpose:** Trajectory contrasts for pattern analysis

**Included contrasts:**
- Early: G32A_vs_Ctrl_D35, R403C_vs_Ctrl_D35
- Late: G32A_vs_Ctrl_D65, R403C_vs_Ctrl_D65
- TrajDev: Maturation_G32A_specific, Maturation_R403C_specific

**Excluded:** Time_Ctrl, Time_G32A, Time_R403C (reference contrasts)

### gsea_trajectory.csv

**Purpose:** Significant trajectory pathways for focused analysis

**Filters:**
- Trajectory contrasts only
- p.adjust < 0.05

### contrast_mapping.csv

**Purpose:** Translate between naming conventions

**Columns:**

| Column | Description |
|--------|-------------|
| `old_name` | Original contrast name (e.g., `G32A_vs_Ctrl_D35`) |
| `new_name` | Trajectory name (e.g., `Early_G32A`) |
| `category` | Stage (Early, Late, TrajDev) |
| `mutation` | Mutation type (G32A, R403C, Control) |

**Mapping Table:**

| Original | New | Category | Mutation |
|----------|-----|----------|----------|
| G32A_vs_Ctrl_D35 | Early_G32A | Early | G32A |
| R403C_vs_Ctrl_D35 | Early_R403C | Early | R403C |
| G32A_vs_Ctrl_D65 | Late_G32A | Late | G32A |
| R403C_vs_Ctrl_D65 | Late_R403C | Late | R403C |
| Maturation_G32A_specific | TrajDev_G32A | TrajDev | G32A |
| Maturation_R403C_specific | TrajDev_R403C | TrajDev | R403C |
| Time_Ctrl | Time_Ctrl | Reference | Control |
| Time_G32A | Time_G32A | Reference | G32A |
| Time_R403C | Time_R403C | Reference | R403C |

---

## Usage Examples

### Python: Load and filter

```python
import pandas as pd

# Load all GSEA results
gsea = pd.read_csv('Python_exports/gsea_results_long.csv')

# Filter by database
hallmark = gsea[gsea['database'] == 'hallmark']

# Filter by significance
sig = gsea[gsea['p.adjust'] < 0.05]

# Filter by contrast
early_g32a = gsea[gsea['new_name'] == 'Early_G32A']
```

### Python: Pivot for heatmap

```python
# Create NES heatmap matrix
pivot = gsea.pivot_table(
    index='Description',
    columns='new_name',
    values='NES',
    aggfunc='first'
)

# Plot
import seaborn as sns
sns.heatmap(pivot, center=0, cmap='RdBu_r')
```

### Python: Pattern analysis

```python
# Load trajectory data
traj = pd.read_csv('Python_exports/gsea_trajectory.csv')

# Separate by mutation
g32a = traj[traj['mutation'] == 'G32A']
r403c = traj[traj['mutation'] == 'R403C']

# Compare Early vs Late
early = traj[traj['category'] == 'Early']
late = traj[traj['category'] == 'Late']
```

### Python: Apply contrast mapping

```python
# Load mapping
mapping = pd.read_csv('Python_exports/contrast_mapping.csv')

# Merge with results
merged = gsea.merge(mapping, left_on='contrast', right_on='old_name')
```

---

## Downstream Scripts

These exports are used by:

| Script | Input File | Output |
|--------|------------|--------|
| `6.publication_figures.py` | gsea_trajectory.csv | Publication_Figures/*.pdf |
| `6b.publication_figures_dotplot.py` | gsea_trajectory.csv | Publication_Figures_Dotplot/*.pdf |
| `8.pattern_summary_normalized.py` | gsea_significant.csv | Pattern_Summary_Normalized/*.pdf |
| `9.create_master_pathway_table.py` | gsea_results_long.csv | master_pathway_table.csv |

---

## Generation Script

```r
# 02_Analysis/3.export_gsea_for_python.R

# Loads checkpoint
all_gsea <- readRDS("checkpoints/all_gsea_results.rds")
syngo <- readRDS("checkpoints/syngo_gsea_results.rds")
mito <- readRDS("checkpoints/mitocarta_gsea_results.rds")

# Converts to long format
# Adds database labels
# Applies contrast mapping
# Saves as CSV
```

### Regeneration

```bash
Rscript 02_Analysis/3.export_gsea_for_python.R
```

Requires: `checkpoints/all_gsea_results.rds`, `checkpoints/syngo_gsea_results.rds`, `checkpoints/mitocarta_gsea_results.rds`

---

## Data Quality Notes

### NES Interpretation

| NES Range | Interpretation |
|-----------|----------------|
| > +2.0 | Strong upregulation |
| +1.0 to +2.0 | Moderate upregulation |
| -1.0 to +1.0 | Minimal effect |
| -2.0 to -1.0 | Moderate downregulation |
| < -2.0 | Strong downregulation |

### Missing Values

Some pathway x contrast combinations may have `NA` values when:
- Pathway gene set was too small (< 10 genes)
- Pathway gene set was too large (> 500 genes)
- No genes from pathway were expressed

### Database Coverage

| Database | Pathways | Typical Significant |
|----------|----------|---------------------|
| Hallmark | 50 | 20-35 |
| KEGG | 186 | 50-100 |
| Reactome | 1,615 | 200-500 |
| GO:BP | 7,658 | 1,000-2,000 |
| GO:CC | 1,006 | 100-300 |
| GO:MF | 1,738 | 200-500 |
| WikiPathways | 664 | 100-200 |
| SynGO | ~300 | 20-50 |
| MitoCarta | 149 | 30-60 |

---

## Related Documentation

- `../README.md` - Main analysis overview
- `../checkpoints/README.md` - Source checkpoint files
- `../MASTER_TABLE_README.md` - Master table documentation
- `02_Analysis/3.export_gsea_for_python.R` - Generation script
