# Critical Period Trajectories

## Overview

This folder contains GSVA-based trajectory visualizations showing how 7 key functional modules change during neuronal maturation (D35 to D65) in Control vs. DRP1 mutant neurons. The analysis uses Gene Set Variation Analysis (GSVA) enrichment scores to track coordinated changes in ribosome-related and mitochondrial pathways during the critical developmental period.

## Generating Script

**Primary script:** `02_Analysis/2.4.viz_critical_period_trajectories_gsva.R`

**Dependencies:**
- Checkpoint files from main differential expression pipeline (`1.1.main_pipeline.R`)
- Normalized expression data (logCPM from limma-voom)
- GSVA package for enrichment scoring

**To regenerate:**
```bash
Rscript 02_Analysis/2.4.viz_critical_period_trajectories_gsva.R
```

## Directory Structure

```
Critical_period_trajectories/
├── README.md (this file)
└── gsva/
    ├── combined/          # Multi-panel combined figures
    ├── data/              # Exported data tables
    ├── divergence/        # Divergence trajectory panels (7 modules)
    └── trajectory/        # Absolute trajectory panels (7 modules)
```

## Contents

### Figures - Combined Visualizations

Located in `gsva/combined/`

| File | Description | Generated By |
|------|-------------|-------------|
| `Trajectory_7panel_grid.pdf` | All 7 module trajectory panels in grid layout (3 rows × 3 columns) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Trajectory_7panel_grid-1.png` | PNG version of 7-panel grid (for presentations) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Divergence_overlay_all.pdf` | All 7 modules overlaid showing divergence from control (multi-color) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Divergence_overlay_mitocarta.pdf` | 4 mitochondrial compensation modules overlaid (D-G only) | `2.4.viz_critical_period_trajectories_gsva.R` |

### Figures - Individual Trajectory Panels

Located in `gsva/trajectory/`

Shows GSVA enrichment scores relative to Control D35 baseline. Control trajectory shows normal developmental changes; mutant trajectories show genotype-specific patterns.

| File | Module | Key Finding | Generated By |
|------|--------|-------------|-------------|
| `Panel_A_Ribosome_Biogenesis.pdf` | Ribosome Biogenesis | Control normally decreases; mutants resist downregulation (compensatory maintenance) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_B_Cytoplasmic_Translation.pdf` | Cytoplasmic Translation | Control increases; mutants fail to increase (functional failure) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_C_Synaptic_Ribosomes.pdf` | Synaptic Ribosomes | Control increases; mutants decline (critical period crisis) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_D_Mitochondrial_Ribosome.pdf` | Mitochondrial Ribosome | Shared compensation in both mutations (mitochondrial ribosome production) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_E_Mito_Ribosome_Assembly.pdf` | Mito Ribosome Assembly | Shared compensation in both mutations (mitoribosome assembly machinery) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_F_mtDNA_Maintenance.pdf` | mtDNA Maintenance | Shared compensation in both mutations (mtDNA replication/repair) | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_G_OXPHOS.pdf` | OXPHOS | Shared compensation in both mutations (oxidative phosphorylation) | `2.4.viz_critical_period_trajectories_gsva.R` |

### Figures - Individual Divergence Panels

Located in `gsva/divergence/`

Shows divergence from control at each timepoint (removes developmental baseline). Y-axis represents mutation-specific effects after accounting for normal development.

| File | Module | Description | Generated By |
|------|--------|-------------|-------------|
| `Panel_A_Ribosome_Biogenesis.pdf` | Ribosome Biogenesis | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_B_Cytoplasmic_Translation.pdf` | Cytoplasmic Translation | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_C_Synaptic_Ribosomes.pdf` | Synaptic Ribosomes | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_D_Mitochondrial_Ribosome.pdf` | Mitochondrial Ribosome | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_E_Mito_Ribosome_Assembly.pdf` | Mito Ribosome Assembly | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_F_mtDNA_Maintenance.pdf` | mtDNA Maintenance | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |
| `Panel_G_OXPHOS.pdf` | OXPHOS | Mutant divergence from control trajectory | `2.4.viz_critical_period_trajectories_gsva.R` |

### Data Files

Located in `gsva/data/`

| File | Description | Format | Generated By |
|------|-------------|--------|-------------|
| `gsva_scores_matrix.csv` | GSVA enrichment scores for all 7 modules across 6 experimental groups (Ctrl/G32A/R403C × D35/D65) | Wide format CSV with columns: Module, Group, Timepoint, GSVA_Score | `2.4.viz_critical_period_trajectories_gsva.R` |
| `trajectory_data.csv` | Mean trajectory values (expression relative to Ctrl D35) for all modules and genotypes | Columns: Module, Genotype, Timepoint, Mean_Expression, SD | `2.4.viz_critical_period_trajectories_gsva.R` |
| `divergence_data.csv` | Divergence from control at each timepoint (mutation-specific effects) | Columns: Module, Genotype, Timepoint, Divergence, SD | `2.4.viz_critical_period_trajectories_gsva.R` |
| `module_gene_counts.csv` | Gene counts for each of the 7 functional modules | Columns: Module, N_Genes | `2.4.viz_critical_period_trajectories_gsva.R` |

## The 7 Key Modules

### Ribosome/Translation Modules (A-C)

1. **Ribosome Biogenesis** (Panel A) - Production of ribosomal proteins and ribosome assembly machinery
2. **Cytoplasmic Translation** (Panel B) - Cytoplasmic translation initiation and elongation factors
3. **Synaptic Ribosomes** (Panel C) - Localized translation machinery at synapses (from SynGO annotations)

### Mitochondrial Compensation Modules (D-G)

4. **Mitochondrial Ribosome** (Panel D) - Mitoribosomal proteins (MRPL/MRPS genes)
5. **Mito Ribosome Assembly** (Panel E) - Mitoribosome assembly factors
6. **mtDNA Maintenance** (Panel F) - mtDNA replication, transcription, and repair machinery
7. **OXPHOS** (Panel G) - Oxidative phosphorylation complexes I-V

## Key Methodological Details

### GSVA Enrichment Scores

- **Method:** Gene Set Variation Analysis (GSVA) using Gaussian kernel
- **Input:** Log2 CPM normalized expression values from limma-voom
- **Output:** Per-sample enrichment scores for each module (independent of phenotype labels)
- **Interpretation:** Higher scores = coordinated upregulation of module genes; lower scores = coordinated downregulation

### Two Complementary Y-Axis Scales

**Trajectory panels** (absolute scale):
- Y-axis: GSVA score relative to Control D35 baseline
- Shows: Total expression change including developmental + genotype effects
- Control trajectory: Shows normal developmental changes (can move away from zero)
- Use case: Compare developmental patterns across genotypes

**Divergence panels** (relative scale):
- Y-axis: Divergence from control at same timepoint
- Shows: Mutation-specific effects after removing developmental baseline
- Control trajectory: Not shown (would be zero by definition)
- Use case: Compare mutation effects across timepoints

### Visual Elements

**Individual sample points:**
- Small semi-transparent dots (n=3 biological replicates per group/timepoint)
- X-axis jittered by ±0.5 days to prevent overplotting
- Show biological variability and reproducibility

**Mean trajectory lines:**
- Thick prominent lines connecting mean values at D35 and D65
- Show overall developmental trend for each genotype

**Color coding:**
- In trajectory/divergence panels: Gray = Control, Orange = G32A, Green = R403C
- In overlay panels: Colors represent different modules, shapes/lines represent genotypes

## Biological Interpretation

### The Paradoxical Pattern

**Normal development (Control):**
- Ribosome biogenesis decreases (less production needed in mature neurons)
- Translation capacity increases (functional maturation)
- Synaptic ribosomes increase (synaptogenesis support)
- Coordinated changes support synaptic maturation

**DRP1 mutant response:**
- Ribosome biogenesis increases MORE than control (compensatory attempt)
- Translation capacity DECLINES (functional failure despite more ribosomes)
- Synaptic ribosomes FAIL to increase (critical period crisis)
- Uncoupled processes suggest energy/ATP bottleneck

### Shared Mitochondrial Compensation (Panels D-G)

Both G32A and R403C mutations show coordinated upregulation of 4 mitochondrial pathways:
1. Mitochondrial ribosome production
2. Mitoribosome assembly machinery
3. mtDNA maintenance systems
4. OXPHOS complexes

This represents a mutation-independent compensatory response to DRP1 dysfunction, attempting to restore mitochondrial function.

### The Critical Period Crisis

The D35→D65 window is when cortical neurons undergo rapid synaptogenesis. The failure to maintain synaptic translation capacity during this window likely underlies the seizure phenotype in DRP1 mutants, as synapses cannot support the energy/protein demands of circuit maturation.

## How to Regenerate

```bash
# Full analysis with GSVA computation (~5-10 min)
Rscript 02_Analysis/2.4.viz_critical_period_trajectories_gsva.R

# Uses checkpointing - delete checkpoint to force recomputation
rm 03_Results/02_Analysis/checkpoints/gsva_7modules_checkpoint.rds
Rscript 02_Analysis/2.4.viz_critical_period_trajectories_gsva.R
```

## Related Visualizations

- **[../Publication_Figures/](../Publication_Figures/)** - Main manuscript figures
- **[../Ribosome_paradox/](../Ribosome_paradox/)** - Core ribosome downregulation finding
- **[../Mito_translation_cascade/](../Mito_translation_cascade/)** - Mechanistic cascade visualization
- **[../Synaptic_ribosomes/](../Synaptic_ribosomes/)** - Synaptic translation deep-dive
- **[../Pattern_Summary_Normalized/](../Pattern_Summary_Normalized/)** - Pattern classification summary

## Notes

- GSVA analysis uses checkpoint caching to avoid expensive recomputation
- All 7 modules are derived from significant pathway enrichments in the main GSEA analysis
- Individual sample points provide transparency about biological variability
- Both trajectory and divergence views are necessary to fully interpret developmental perturbations
