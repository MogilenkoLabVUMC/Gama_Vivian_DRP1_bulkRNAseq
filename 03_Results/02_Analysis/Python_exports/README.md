# Python Data Exports

**Location:** `03_Results/02_Analysis/Python_exports/`
**Generated by:** `02_Analysis/1.4.export_gsea_for_python.R`
**Last Updated:** 2025-12-04

---

## Overview

This folder contains CSV exports of GSEA results formatted for Python-based analysis. These files bridge the R analysis pipeline with Python visualization scripts.

**Key principle:** These are intermediate files consumed by `1.5.create_master_pathway_table.py` to produce the authoritative `master_gsea_table.csv`. Most downstream scripts should use the master table, not these files directly.

---

## File Inventory

| File | Size | Rows | Description |
|------|------|------|-------------|
| `gsea_results_long.csv` | 31 MB | ~110K | All GSEA statistics in long format |
| `gsea_results_wide.csv` | 4.9 MB | ~12K | Pivot table with p.adjust columns |

---

## File Details

### gsea_results_long.csv

**Purpose:** Complete GSEA results - primary input for master table generation

**Columns:**

| Column | Type | Description |
|--------|------|-------------|
| `pathway_id` | string | Unique ID (format: `database::pathway_name`) |
| `database` | string | Source database (hallmark, kegg, etc.) |
| `ID` | string | Original pathway ID |
| `Description` | string | Human-readable pathway name |
| `contrast` | string | Original contrast name |
| `new_name` | string | Trajectory framework name |
| `category` | string | Stage: Early, Late, TrajDev, Reference |
| `mutation` | string | G32A, R403C, or Control |
| `NES` | float | Normalized Enrichment Score |
| `pvalue` | float | Raw p-value |
| `p.adjust` | float | FDR-adjusted p-value |
| `qvalue` | float | Q-value |
| `enrichmentScore` | float | Raw enrichment score |
| `setSize` | int | Number of genes in set |
| `ever_significant` | bool | True if pathway significant in any contrast |
| `ever_significant_trajectory` | bool | True if significant in any trajectory contrast |

### gsea_results_wide.csv

**Purpose:** Pivot table providing p.adjust values in trajectory format for downstream merging

**Structure:**
- Rows: unique pathways
- Columns: NES and p.adjust values for each contrast

```
pathway_id, database, Description, NES_G32A_vs_Ctrl_D35, p.adjust_G32A_vs_Ctrl_D35, ...
```

---

## Data Flow

```
1.4.export_gsea_for_python.R
    │
    ├─► gsea_results_long.csv ─────► 1.5.create_master_pathway_table.py
    │                                        │
    │                                        ▼
    │                               master_gsea_table.csv ──► All Python viz scripts
    │
    └─► gsea_results_wide.csv ─────► data_loader.py (merges p.adjust columns)
                                     3.5.viz_trajectory_flow.py
                                     Supp4.sensitivity_analysis.py
```

---

## Downstream Consumption

| Script | Input File | Output |
|--------|------------|--------|
| `1.5.create_master_pathway_table.py` | `gsea_results_long.csv` | `master_gsea_table.csv` |
| `data_loader.py` | `gsea_results_wide.csv` | (module - p.adjust merge) |
| `3.5.viz_trajectory_flow.py` | `gsea_results_wide.csv` | Trajectory_Flow/*.pdf |
| `Supp4.sensitivity_analysis.py` | `gsea_results_wide.csv` | Sensitivity analysis |

**Note:** Most Python visualization scripts (3.1, 3.2, 3.4, 3.6, 3.7, 3.8) use `master_gsea_table.csv` directly.

---

## Regeneration

```bash
Rscript 02_Analysis/1.4.export_gsea_for_python.R
```

**Requires:**
- `checkpoints/all_gsea_results.rds`
- `checkpoints/syngo_gsea_results.rds`
- `checkpoints/mitocarta_gsea_results.rds`

---

## Contrast Mapping Reference

| Original Contrast | Trajectory Name | Category | Mutation |
|-------------------|-----------------|----------|----------|
| G32A_vs_Ctrl_D35 | Early_G32A | Early | G32A |
| R403C_vs_Ctrl_D35 | Early_R403C | Early | R403C |
| G32A_vs_Ctrl_D65 | Late_G32A | Late | G32A |
| R403C_vs_Ctrl_D65 | Late_R403C | Late | R403C |
| Maturation_G32A_specific | TrajDev_G32A | TrajDev | G32A |
| Maturation_R403C_specific | TrajDev_R403C | TrajDev | R403C |
| Time_Ctrl | Time_Ctrl | Reference | Control |
| Time_G32A | Time_G32A | Reference | G32A |
| Time_R403C | Time_R403C | Reference | R403C |

---

## Related Documentation

- `docs/DATA_LINEAGE.md` - Complete data flow documentation
- `../README.md` - Main analysis overview
- `02_Analysis/1.4.export_gsea_for_python.R` - Generation script
