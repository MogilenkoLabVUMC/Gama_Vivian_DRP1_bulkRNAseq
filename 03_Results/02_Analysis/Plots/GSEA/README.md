# Gene Set Enrichment Analysis (GSEA) Results

**Location:** `03_Results/02_Analysis/Plots/GSEA/`
**Generated by:** `02_Analysis/1a.Main_pipeline.R` and `02_Analysis/2.add_MitoCarta.R`
**Last Updated:** 2025-11-25

---

## Overview

This directory contains GSEA visualizations organized by contrast and database. The analysis covers 9 experimental contrasts across 12 pathway databases, generating ~1,000 PDF visualizations.

---

## Directory Structure

```
GSEA/
├── README.md (this file)
│
├── Cross_database_pooled/        # Combined visualizations across databases
│   ├── comprehensive/            # All databases
│   └── focused/                  # Hallmark + KEGG + Reactome
│
├── G32A_vs_Ctrl_D35/            # Contrast-specific results
│   ├── hallmark/
│   ├── kegg/
│   ├── reactome/
│   ├── gobp/
│   ├── gocc/
│   ├── gomf/
│   ├── wiki/
│   ├── canon/
│   ├── cgp/
│   ├── tf/
│   ├── SynGO/
│   └── MitoCarta/
│
├── G32A_vs_Ctrl_D65/            # (same structure)
├── R403C_vs_Ctrl_D35/
├── R403C_vs_Ctrl_D65/
├── Time_Ctrl/
├── Time_G32A/
├── Time_R403C/
├── Maturation_G32A_specific/
└── Maturation_R403C_specific/
```

---

## Database Descriptions

### MSigDB Collections

| Database | Folder | Pathways | Description |
|----------|--------|----------|-------------|
| **Hallmark** | hallmark/ | 50 | Curated biological states and processes |
| **KEGG** | kegg/ | 186 | Metabolic and signaling pathways |
| **Reactome** | reactome/ | 1,615 | Curated reaction pathways |
| **GO:BP** | gobp/ | 7,658 | Gene Ontology Biological Process |
| **GO:CC** | gocc/ | 1,006 | Gene Ontology Cellular Component |
| **GO:MF** | gomf/ | 1,738 | Gene Ontology Molecular Function |
| **WikiPathways** | wiki/ | 664 | Community-curated pathways |
| **Canonical** | canon/ | 2,922 | Combined canonical pathways |
| **CGP** | cgp/ | 3,358 | Chemical and Genetic Perturbations |
| **TF** | tf/ | 1,137 | Transcription Factor targets |

### Custom Databases

| Database | Folder | Pathways | Description |
|----------|--------|----------|-------------|
| **SynGO** | SynGO/ | ~300 | Synaptic Gene Ontology (CC namespace) |
| **MitoCarta** | MitoCarta/ | 149 | Mitochondrial pathways (MitoCarta 3.0) |

---

## File Types Per Database

Each database folder contains 7 plot types:

| File Pattern | Description |
|--------------|-------------|
| `[contrast]_[db]_dotplot.pdf` | Traditional GSEA dotplot (x=GeneRatio, y=Pathway) |
| `[contrast]_[db]_combined.pdf` | Multi-panel combined view |
| `[contrast]_[db]_facet.pdf` | Faceted by up/down regulation |
| `[contrast]_[db]_nes_bar.pdf` | NES bar chart (top pathways) |
| `[contrast]_[db]_running_sum.pdf` | GSEA running sum enrichment plot |
| `[contrast]_[db]_up_dot.pdf` | Upregulated pathways only |
| `[contrast]_[db]_down_dot.pdf` | Downregulated pathways only |

**Additional files may include:**
- `GSEA_[db]_result.rds` - Raw GSEA result object
- `[contrast]_[db]_results.txt` - Text summary

---

## Plot Descriptions

### Dotplot (Primary Visualization)

**File:** `*_dotplot.pdf`

**What it shows:**
- Y-axis: Pathway names (top 30 by significance)
- X-axis: Gene ratio (proportion of genes in set)
- Color: NES (Normalized Enrichment Score)
  - Red/Orange: Positive NES (upregulated)
  - Blue: Negative NES (downregulated)
- Size: -log10(adjusted p-value)

**Interpretation:**
- Larger dots = more significant
- Redder dots = stronger upregulation
- Bluer dots = stronger downregulation

### Combined Plot

**File:** `*_combined.pdf`

**What it shows:**
Multi-panel figure with:
- Dotplot
- Bar chart of top NES
- Running sum for top pathways
- Summary statistics

### Faceted Plot

**File:** `*_facet.pdf`

**What it shows:**
- Left panel: Downregulated pathways (NES < 0)
- Right panel: Upregulated pathways (NES > 0)

### NES Bar Chart

**File:** `*_nes_bar.pdf`

**What it shows:**
- Horizontal bar chart
- Bars colored by NES direction
- Length proportional to NES magnitude
- Labels show pathway names

### Running Sum Plot

**File:** `*_running_sum.pdf`

**What it shows:**
- X-axis: Ranked gene list position
- Y-axis: Running enrichment score
- Peak = enrichment score (ES)
- Vertical lines = gene set members

**Interpretation:**
- Sharp peak = strong enrichment
- Peak location = where gene set concentrates
- Multiple pathways overlaid for comparison

### Up/Down Dotplots

**Files:** `*_up_dot.pdf`, `*_down_dot.pdf`

**What they show:**
- Filtered to show only positive (up) or negative (down) NES
- Same format as main dotplot
- Useful when one direction dominates

---

## Contrast Interpretation

### Mutation Effects (Baseline)

| Contrast | Interpretation of positive NES |
|----------|-------------------------------|
| G32A_vs_Ctrl_D35 | Higher in G32A at Day 35 |
| R403C_vs_Ctrl_D35 | Higher in R403C at Day 35 |
| G32A_vs_Ctrl_D65 | Higher in G32A at Day 65 |
| R403C_vs_Ctrl_D65 | Higher in R403C at Day 65 |

### Time Effects

| Contrast | Interpretation of positive NES |
|----------|-------------------------------|
| Time_Ctrl | Increases during control maturation |
| Time_G32A | Increases during G32A maturation |
| Time_R403C | Increases during R403C maturation |

### Interaction Effects

| Contrast | Interpretation of positive NES |
|----------|-------------------------------|
| Maturation_G32A_specific | G32A maturation exceeds control maturation |
| Maturation_R403C_specific | R403C maturation exceeds control maturation |

---

## GSEA Methodology

### Algorithm: fgsea (Fast GSEA)

```
1. Rank all genes by t-statistic
2. For each gene set:
   a. Walk down ranked list
   b. Increment score when gene is in set
   c. Decrement score when gene is not in set
   d. Record maximum deviation (ES)
3. Normalize ES by gene set size → NES
4. Estimate significance by permutation
5. Adjust for multiple testing (FDR)
```

### Parameters

| Parameter | Value |
|-----------|-------|
| Ranking metric | t-statistic |
| Permutations | 10,000 |
| Min set size | 10 |
| Max set size | 500 |
| p-value cutoff | 0.05 |
| FDR method | Benjamini-Hochberg |

### Interpretation Guidelines

| NES | Interpretation |
|-----|----------------|
| > +2.0 | Strong upregulation |
| +1.5 to +2.0 | Moderate upregulation |
| +1.0 to +1.5 | Mild upregulation |
| -1.0 to +1.0 | No clear enrichment |
| -1.5 to -1.0 | Mild downregulation |
| -2.0 to -1.5 | Moderate downregulation |
| < -2.0 | Strong downregulation |

---

## Cross-Database Pooled

### Location: `Cross_database_pooled/`

Contains visualizations that combine results across databases:

**comprehensive/** - All 12 databases
- Dotplots combining top pathways from each database
- Heatmaps showing cross-database patterns

**focused/** - Hallmark + KEGG + Reactome only
- More readable plots with fewer pathways
- Best for publication figures

---

## Key Findings by Database

### Hallmark

**Most significant pathways:**
- E2F_TARGETS: Strong upregulation (NES +3.31)
- OXIDATIVE_PHOSPHORYLATION: Downregulated early, compensated later
- MYC_TARGETS: Upregulated (proliferation signal)

### SynGO

**Key findings:**
- Presynaptic ribosomes: NES -2.9 (downregulated)
- Postsynaptic ribosomes: NES -3.0 (downregulated)
- Synaptic vesicle pathways: Mixed by mutation

### MitoCarta

**Key findings:**
- Mitochondrial ribosome: Compensated (Early↓ → Late↑)
- OXPHOS: Variable by mutation
- mtDNA maintenance: Upregulated

### GO:BP

**Key findings:**
- Ribosome biogenesis: NES +2.25 (upregulated)
- Cytoplasmic translation: NES -2.07 (downregulated)
- Cell cycle: Strongly upregulated

---

## Usage Examples

### View specific pathway

```bash
# Open G32A vs Control Day 35 Hallmark results
open "GSEA/G32A_vs_Ctrl_D35/hallmark/G32A_vs_Ctrl_D35_hallmark_dotplot.pdf"
```

### Compare databases

```bash
# View all dotplots for one contrast
ls GSEA/G32A_vs_Ctrl_D35/*/G32A_vs_Ctrl_D35_*_dotplot.pdf
```

### Find specific pathway

```bash
# Search for ribosome pathways in results
grep -r "ribosome" GSEA/*/reactome/*_results.txt
```

---

## Generation Scripts

### Main GSEA Pipeline

```r
# 02_Analysis/1a.Main_pipeline.R
all_gsea_results <- load_or_compute(
  checkpoint_file = "checkpoints/all_gsea_results.rds",
  compute_fn = function() {
    for (contrast in names(contrast_tables)) {
      run_gsea_hsmm(contrast_tables[[contrast]], contrast, "Homo sapiens")
    }
  }
)
```

### SynGO GSEA

```r
# 02_Analysis/1a.Main_pipeline.R
syngo_gsea_results <- load_or_compute(
  checkpoint_file = "checkpoints/syngo_gsea_results.rds",
  compute_fn = function() {
    for (contrast in names(contrast_tables)) {
      run_syngo_gsea(contrast_tables[[contrast]], contrast, ...)
    }
  }
)
```

### MitoCarta GSEA

```r
# 02_Analysis/2.add_MitoCarta.R
mitocarta_results <- load_or_compute(
  checkpoint_file = "checkpoints/mitocarta_gsea_results.rds",
  compute_fn = function() {
    for (contrast in names(contrast_tables)) {
      run_mitocarta_gsea(contrast_tables[[contrast]], contrast, ...)
    }
  }
)
```

---

## Troubleshooting

### Empty plot or "no results"

Some database/contrast combinations may have no significant pathways:
- File will show "No significant pathways" message
- This is expected for specific combinations

### Missing MitoCarta or SynGO

These are generated by separate scripts:
- SynGO: Part of main pipeline
- MitoCarta: Run `02_Analysis/2.add_MitoCarta.R`

### Unreadable pathway names

Long pathway names may be truncated. See:
- Full names in `*_results.txt` files
- Python exports: `Python_exports/gsea_results_long.csv`

---

## Related Documentation

- `../README.md` - Overall Plots directory
- `../../README.md` - Main analysis overview
- `../../Python_exports/README.md` - GSEA data exports
- `../../checkpoints/README.md` - Source RDS files
- `CLAUDE.md` - GSEA configuration parameters
